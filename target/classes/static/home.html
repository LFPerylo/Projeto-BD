<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>In칤cio</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
<div id="sidebar-container"></div>

<div class="main-content">
  <h1>Painel Administrativo</h1>

  <section id="dashboard">
    <h2>游늵 Temas Mais Utilizados</h2>
    <canvas id="grafico-temas" width="600" height="300"></canvas>
  </section>

  <section id="aniversariantes-proximos">
    <h2>游꾹 Aniversariantes nos Pr칩ximos 45 Dias</h2>
    <canvas id="grafico-aniversariantes" width="600" height="300"></canvas>
  </section>
</div>

<script>
  // Carregar a sidebar externa
  fetch("/sidebar.html")
          .then(res => res.text())
          .then(html => document.getElementById("sidebar-container").innerHTML = html);

  // Carregar gr치fico de temas
  async function carregarGraficoTemas() {
    try {
      const response = await fetch("/temas/mais-usados");
      if (!response.ok) throw new Error("Erro ao buscar dados do gr치fico");

      const dados = (await response.json())
              .filter(d => d.quantidade > 0)
              .sort((a, b) => b.quantidade - a.quantidade)
              .slice(0, 5);

      const nomes = dados.map(d => d.tema);
      const quantidades = dados.map(d => d.quantidade);

      new Chart(document.getElementById("grafico-temas"), {
        type: 'bar',
        data: {
          labels: nomes,
          datasets: [{
            label: 'Temas mais utilizados',
            data: quantidades,
            backgroundColor: '#a267d0'
          }]
        },
        options: {
          responsive: true,
          scales: {
            y: {
              beginAtZero: true,
              ticks: {
                stepSize: 1,
                precision: 0,
                callback: function(value) {
                  return Number.isInteger(value) ? value : null;
                }
              }
            }
          }
        }
      });
    } catch (erro) {
      console.error("Erro ao carregar gr치fico:", erro);
    }
  }

  // Gr치fico de aniversariantes (nome + c칩digo)
  async function carregarGraficoAniversariantes() {
    try {
      const response = await fetch("/festas/aniversariantes/proximos");
      if (!response.ok) throw new Error("Erro ao buscar aniversariantes");

      const dados = await response.json();

      const labels = dados.map(p => `${p.cod_aniversariante} - ${p.nome}`);
      const diasRestantes = dados.map(p => p.dias_restantes);

      new Chart(document.getElementById("grafico-aniversariantes"), {
        type: 'bar',
        data: {
          labels: labels,
          datasets: [{
            label: 'Dias restantes para o anivers치rio',
            data: diasRestantes,
            backgroundColor: '#d08aa2'
          }]
        },
        options: {
          responsive: true,
          scales: {
            y: {
              beginAtZero: true,
              ticks: {
                stepSize: 1,
                precision: 0,
                callback: function (value) {
                  return Number.isInteger(value) ? value : null;
                }
              }
            }
          }
        }
      });
    } catch (erro) {
      console.error("Erro ao carregar gr치fico de aniversariantes:", erro);
    }
  }

  // Ao carregar a p치gina
  window.onload = () => {
    carregarGraficoTemas();
    carregarGraficoAniversariantes();
  };
</script>
</body>
</html>
